@{
    ViewData["Title"] = "Quản lý Tour";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@model IEnumerable<TourViet.Models.Tour>

@{
    var tours = ViewBag.Tours as IEnumerable<TourViet.Models.Tour>;
}

<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            <h1 class="h3 mb-4">Quản lý Tour</h1>
            
            <div class="card shadow mb-4">
                <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                    <h6 class="m-0 font-weight-bold text-primary">Danh sách Tour</h6>
                    <div class="dropdown no-arrow">
                        <a class="dropdown-toggle" href="#" role="button" id="dropdownMenuLink" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            <i class="fas fa-ellipsis-v fa-sm fa-fw text-gray-400"></i>
                        </a>
                        <div class="dropdown-menu dropdown-menu-right shadow animated--fade-in" aria-labelledby="dropdownMenuLink">
                            <div class="dropdown-header">Tùy chọn:</div>
                            <a class="dropdown-item" href="#">Thêm mới</a>
                            <a class="dropdown-item" href="#">Xuất dữ liệu</a>
                            <div class="dropdown-divider"></div>
                            <a class="dropdown-item text-danger" href="#">Xóa mục đã chọn</a>
                        </div>
                    </div>
                <div class="card-body">
                   <div class="d-flex justify-content-between align-items-center mb-3">
                       <a asp-controller="Tour" asp-action="Create" class="btn btn-primary">Thêm mới Tour</a>
                       @if (TempData["SuccessMessage"] != null)
                       {
                           <div class="alert alert-success alert-dismissible fade show" role="alert">
                               @TempData["SuccessMessage"]
                               <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                           </div>
                       }
                   </div>
                   
                   <div class="table-responsive">
                       <table class="table table-bordered" id="toursTable">
                           <thead>
                               <tr>
                                   <th>Tên Tour</th>
                                   <th>Địa điểm</th>
                                   <th>Mô tả ngắn</th>
                                   <th>Trạng thái</th>
                                   <th>Ngày tạo</th>
                                   <th>Hành động</th>
                               </tr>
                           </thead>
                           <tbody>
                               @if (ViewBag.Tours != null && ViewBag.Tours.Any())
                               {
                                   @foreach (var tour in ViewBag.Tours)
                                   {
                                       <tr>
                                           <td>@tour.TourName</td>
                                           <td>
                                               @(tour.Location != null ? tour.Location.LocationName : "Chưa có địa điểm")
                                           </td>
                                           <td>
                                               @(string.IsNullOrEmpty(tour.ShortDescription) ? "Chưa có mô tả" : tour.ShortDescription)
                                           </td>
                                           <td>
                                               <span class="badge @(tour.IsPublished ? "bg-success" : "bg-warning")">
                                                   @(tour.IsPublished ? "Đang hoạt động" : "Chưa kích hoạt")
                                               </span>
                                           </td>
                                           <td>@tour.CreatedAt.ToString("dd/MM/yyyy")</td>
                                           <td>
                                               <a asp-controller="Tour" asp-action="Details" asp-route-id="@tour.TourID" class="btn btn-sm btn-info">Xem</a>
                                               <a asp-controller="Tour" asp-action="Edit" asp-route-id="@tour.TourID" class="btn btn-sm btn-primary">Sửa</a>
                                               <a asp-controller="Tour" asp-action="Delete" asp-route-id="@tour.TourID" class="btn btn-sm btn-danger">Xóa</a>
                                           </td>
                                       </tr>
                                   }
                               }
                               else
                               {
                                   <tr>
                                       <td colspan="6" class="text-center">Không có dữ liệu tour</td>
                                   </tr>
                               }
                           </tbody>
                       </table>
                   </div>
                </div>
            </div>
        </div>
   </div>
</div>
</div>
<script>
   // Auto-hide success alerts after 5 seconds
   setTimeout(function() {
       var alert = document.querySelector('.alert');
       if (alert) {
           var bsAlert = new bootstrap.Alert(alert);
           bsAlert.close();
       }
   }, 5000);
</script>